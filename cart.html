<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì¥ë°”êµ¬ë‹ˆ - YUSINSA</title>
<link href="https://fonts.googleapis.com/css2?family=Stylish&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    :root{
        --green:#2e7d32;
        --light-green:#dcedc8;
        --red:#d32f2f;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Noto Sans KR",sans-serif;background:#fafafa;color:#222;}
    header{
        height:64px;
        border-bottom:10px solid #e6e6e6;
        background:var(--green);
        color:#fff;
        position:sticky;
        top:0;
        z-index:200;
        display:flex;
        align-items:center;
        padding:0 20px;
        justify-content:space-between;
    }
    .left-area{ display:flex; align-items:center; gap:10px; }
    .left-area h1{ margin:0; font-family:'Stylish',sans-serif; font-size:22px; cursor:pointer; }
    .home-btn{ background:rgba(255,255,255,0.15); color:#fff; padding:6px 10px; border-radius:6px; text-decoration:none; font-weight:700; font-size:14px; }
    .home-btn:hover{background:rgba(255,255,255,0.28);}
    nav{ position:absolute; left:50%; transform:translateX(-50%); top:0; height:100%; display:flex; align-items:center; }
    nav ul{ display:flex; gap:100px; margin:0; padding:0; list-style:none; }
    nav a{color:#fff;text-decoration:none;font-weight:700;font-size:15px}
    nav a:hover{color:var(--light-green)}
    .right-space{ display:flex; align-items:center; gap:12px; }
    .header-btn{ background:rgba(255,255,255,0.15); color:#fff; padding:6px 10px; border-radius:6px; text-decoration:none; font-weight:700; font-size:14px; transition:background 0.2s; }
    .header-btn:hover{ background:rgba(255,255,255,0.28); }
    .header-icon{ color:#fff; font-size:20px; text-decoration:none; padding:4px; transition:color 0.2s; }
    .header-icon:hover{ color:var(--light-green); }

    /* === [ìˆ˜ì •] ë¡œê·¸ì¸ UI ìŠ¤íƒ€ì¼ (ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼) === */
    .user-welcome { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; color: #fff; }
    .user-welcome span { color: var(--light-green); }
    .user-welcome a {
      text-decoration: none; font-weight: 700; padding: 6px 10px; border-radius: 6px;
      background-color: #d32f2f; color: #fff; border: 1px solid #d32f2f;
      transition: all 0.3s; cursor: pointer; font-size: 14px; 
    }
    .user-welcome a:hover { background-color: #b71c1c; border-color: #b71c1c; color: #fff; }

    main{
        width: 100%;
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }
    h2 {
        font-size: 24px;
        border-bottom: 2px solid var(--green);
        padding-bottom: 10px;
        margin-bottom: 30px;
    }
    .cart-item {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
        margin-bottom: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .cart-item img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 8px;
    }
    .item-info { flex-grow: 1; }
    .item-info h3 { margin: 0 0 10px; font-size: 18px; }
    .item-info p { margin: 4px 0; color: #666; font-size: 14px; }
    .item-price {
        font-size: 18px;
        font-weight: 700;
        min-width: 120px;
        text-align: right;
    }
    .remove-btn {
        background: var(--red);
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 700;
    }
    .total-summary {
        margin-top: 40px;
        padding: 30px;
        background: #fff;
        border-radius: 10px;
        text-align: right;
    }
    /* === [ìˆ˜ì •] ì¿ í°/ê°€ê²© í‘œì‹œ CSS === */
    .total-summary div { margin-bottom: 10px; }
    .total-summary .final-price {
        font-size: 20px;
        font-weight: 700;
        border-top: 1px dashed #ccc;
        padding-top: 20px;
        margin-top: 20px;
    }
    .total-summary .final-price span {
        color: var(--green);
        font-size: 24px;
        margin-left: 15px;
    }
    #coupon-btn {
        background-color: var(--red);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
    }
    #coupon-btn:hover { background-color: #b71c1c; }
    #coupon-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    #discount-display {
        font-size: 16px; 
        color: var(--red); 
    }
    /* ================================= */
    #empty-cart {
        text-align: center;
        font-size: 18px;
        color: #888;
        padding: 100px 0;
    }
</style>
</head>
<body>

<header>
    <div class="left-area" onclick="location.href='í™ˆí˜ì´ì§€.html'">
        <h1>YUSINSA</h1>
        <a class="home-btn" href="í™ˆí˜ì´ì§€.html">í™ˆìœ¼ë¡œ</a>
    </div>
    <nav aria-label="category-nav">
        <ul>
            <li><a href="outer.html">Outer</a></li>
            <li><a href="jun.html">ìƒì˜</a></li>
            <li><a href="hee.html">í•˜ì˜</a></li>
            <li><a href="hyuk.html">ì•…ì„¸</a></li>
        </ul>
    </nav>
    <div class="right-space">
        <div id="loggedOutButtons" style="display: flex; gap: 12px;">
            <a href="í™ˆí˜ì´ì§€.html" class="header-btn">íšŒì›ê°€ì…</a>
            <a href="í™ˆí˜ì´ì§€.html" class="header-btn">ë¡œê·¸ì¸</a>
        </div>
        <div class="user-welcome" id="loggedInWelcome" style="display: none;">
            <span id="userNameDisplay"></span>
            <a id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
        <a href="cart.html" class="header-icon">ğŸ›’</a>
        <a href="#" class="header-icon">ğŸ”</a>
    </div>
</header>

<main>
    <h2>ì¥ë°”êµ¬ë‹ˆ</h2>
    <div id="cart-container">
        </div>
    
    <div id="total-summary" class="total-summary" style="display: none;">
        <div id="coupon-section">
            <button id="coupon-btn">20% ì‹ ê·œíšŒì› ì¿ í° ì ìš©</button>
        </div>
        
        <div id="price-before-discount" style="font-size: 16px;">
            ìƒí’ˆ ê¸ˆì•¡: â‚©<span id="original-total-price"></span>
        </div>
        
        <div id="discount-display" style="display:none;">
            ì¿ í° í• ì¸: - â‚©<span id="discount-amount"></span>
        </div>
        
        <div class="final-price">
            ì´ ì£¼ë¬¸ ê¸ˆì•¡: <span id="total-price"></span>
        </div>
    </div>
</main>

<script>
    // === [ìˆ˜ì •] í˜„ì¬ ì´ ê°€ê²©ì„ ì €ì¥í•  ë³€ìˆ˜ (ì „ì—­) ===
    let currentTotalPrice = 0;

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function getCart() {
        return JSON.parse(localStorage.getItem('cartItems')) || [];
    }
    function saveCart(cart) {
        localStorage.setItem('cartItems', JSON.stringify(cart));
    }

    // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ì¥ë°”êµ¬ë‹ˆ ë Œë”ë§ ---
    document.addEventListener('DOMContentLoaded', () => {
        renderCart();
        setupLoginUI(); // ë¡œê·¸ì¸ UI ì„¤ì •
        setupCoupon(); // ì¿ í° ë¡œì§ ì„¤ì •
    });

    function renderCart() {
        const cart = getCart();
        const container = document.getElementById('cart-container');
        const summary = document.getElementById('total-summary');
        
        container.innerHTML = ''; // ì´ˆê¸°í™”
        currentTotalPrice = 0; // [ìˆ˜ì •] ì´ì•¡ ì´ˆê¸°í™”
        
        if (cart.length === 0) {
            container.innerHTML = '<p id="empty-cart">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
            summary.style.display = 'none';
            return;
        }
        
        cart.forEach(item => {
            const itemTotalPrice = item.price * item.quantity;
            currentTotalPrice += itemTotalPrice; // [ìˆ˜ì •] ì „ì—­ ë³€ìˆ˜ì— ëˆ„ì 
            
            const itemHTML = `
                <div class="cart-item" data-cart-id="${item.cartId}">
                    <img src="${item.img}" alt="${item.name}">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <p>ì˜µì…˜: ${item.size} / ${item.color}</p>
                        <p>ìˆ˜ëŸ‰: ${item.quantity}ê°œ</p>
                    </div>
                    <div class="item-price">â‚©${itemTotalPrice.toLocaleString()}</div>
                    <button class="remove-btn">ì‚­ì œ</button>
                </div>
            `;
            container.innerHTML += itemHTML;
        });

        // === [ìˆ˜ì •] ê°€ê²© í‘œì‹œ ì—…ë°ì´íŠ¸ ===
        document.getElementById('original-total-price').textContent = currentTotalPrice.toLocaleString();
        document.getElementById('total-price').textContent = `â‚©${currentTotalPrice.toLocaleString()}`;
        summary.style.display = 'block';

        // --- 'ì‚­ì œ' ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        container.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const cartId = e.target.closest('.cart-item').dataset.cartId;
                
                let currentCart = getCart();
                currentCart = currentCart.filter(item => String(item.cartId) !== cartId);
                saveCart(currentCart);
                
                alert('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.reload(); // [ìˆ˜ì •] ì‚­ì œ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì¿ í°/ê°€ê²© ì¬ê³„ì‚°)
            });
        });
    }

    // --- [ìˆ˜ì •] ì¿ í° ì ìš© ë¡œì§ ---
    function setupCoupon() {
        const couponBtn = document.getElementById('coupon-btn');
        const totalPriceSpan = document.getElementById('total-price');
        const discountDisplay = document.getElementById('discount-display');
        const discountAmountSpan = document.getElementById('discount-amount');
        const priceBeforeDiscountDiv = document.getElementById('price-before-discount');

        // 1. ì¿ í° ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ ì´ˆê¸°í™”
        if (localStorage.getItem('couponUsed') === 'true') {
            couponBtn.textContent = 'ì‹ ê·œíšŒì› ì¿ í° (ì‚¬ìš©ë¨)';
            couponBtn.disabled = true;
            priceBeforeDiscountDiv.style.display = 'none'; // ì¿ í° ì¼ìœ¼ë©´ ì›ë˜ ê°€ê²© ìˆ¨ê¸°ê¸°
        } else if (localStorage.getItem('isLoggedIn') !== 'true') {
            couponBtn.textContent = 'ë¡œê·¸ì¸ í›„ ì¿ í° ì‚¬ìš© ê°€ëŠ¥';
            couponBtn.disabled = true;
        } else if (localStorage.getItem('couponAvailable') !== 'true') {
            couponBtn.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤';
            couponBtn.disabled = true;
        } else if (currentTotalPrice === 0) {
            couponBtn.textContent = 'ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”';
            couponBtn.disabled = true;
        }

        // 2. ì¿ í° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        couponBtn.addEventListener('click', () => {
            // ì´ì¤‘ í™•ì¸
            if (localStorage.getItem('isLoggedIn') !== 'true') {
                alert('ë¡œê·¸ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return;
            }
            if (localStorage.getItem('couponAvailable') !== 'true') {
                alert('ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.'); return;
            }
            if (localStorage.getItem('couponUsed') === 'true') {
                alert('ì´ë¯¸ ì¿ í°ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.'); return;
            }

            // 3. ì¿ í° ì ìš©
            const discount = Math.floor(currentTotalPrice * 0.2);
            const finalPrice = currentTotalPrice - discount;

            discountAmountSpan.textContent = discount.toLocaleString();
            totalPriceSpan.textContent = `â‚©${finalPrice.toLocaleString()}`; // ìµœì¢… ê°€ê²© ì—…ë°ì´íŠ¸
            discountDisplay.style.display = 'block'; // í• ì¸ ê¸ˆì•¡ í‘œì‹œ

            couponBtn.textContent = 'ì¿ í° ì ìš© ì™„ë£Œ';
            couponBtn.disabled = true;

            // 4. ìƒíƒœ ì €ì¥
            localStorage.setItem('couponUsed', 'true'); // ì¿ í° ì‚¬ìš©ë¨
            localStorage.removeItem('couponAvailable'); // ì¿ í° ì†Œì§„
            
            alert('20% í• ì¸ ì¿ í°ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
    }


    // --- ë¡œê·¸ì¸ UI ë° ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ---
    function setupLoginUI() {
        const loggedOutButtons = document.getElementById('loggedOutButtons');
        const loggedInWelcome = document.getElementById('loggedInWelcome');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const logoutBtn = document.getElementById('logoutBtn');

        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const storedName = localStorage.getItem('userName');

        if (isLoggedIn === 'true' && storedName) {
            // ë¡œê·¸ì¸ ìƒíƒœ UI
            loggedOutButtons.style.display = 'none';
            loggedInWelcome.style.display = 'flex';
            userNameDisplay.textContent = `${storedName}ë‹˜`;
        } else {
            // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ UI
            loggedOutButtons.style.display = 'flex';
            loggedInWelcome.style.display = 'none';
        }

        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userName'); 
                
                alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'í™ˆí˜ì´ì§€.html'; 
            });
        }
    }
</script>

</body>
</html>